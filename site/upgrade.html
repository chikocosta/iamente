{% extends "base.html" %}

{% block title %}Upgrade de Plano - AtivaMente{% endblock %}

{% block content %}
<div class="upgrade-page">
  <div class="upgrade-header">
    <h1>üöÄ Upgrade seu Plano</h1>
    <p>Desbloqueie todo o potencial do AtivaMente com nossos planos premium</p>
  </div>

  <div class="plans-comparison">
    <div class="plan-card current-plan">
      <div class="plan-badge">Seu Plano Atual</div>
      <div class="plan-header">
        <h3>üÜì Gratuito</h3>
        <div class="plan-price">R$ 0<span>/m√™s</span></div>
      </div>
      <div class="plan-features">
        <div class="feature">‚úÖ 1 gera√ß√£o por dia</div>
        <div class="feature">‚úÖ Todos os tipos de atividade</div>
        <div class="feature">‚úÖ Suporte b√°sico</div>
        <div class="feature">‚úÖ Acesso a exemplos</div>
      </div>
    </div>

    <div class="plan-card premium-plan">
      <div class="plan-badge popular">Mais Popular</div>
      <div class="plan-header">
        <h3>‚≠ê Premium</h3>
        <div class="plan-price">R$ 19<span>/m√™s</span></div>
      </div>
      <div class="plan-features">
        <div class="feature">‚úÖ 10 gera√ß√µes por dia</div>
        <div class="feature">‚úÖ Prioridade na gera√ß√£o</div>
        <div class="feature">‚úÖ Suporte priorit√°rio</div>
        <div class="feature">‚úÖ Hist√≥rico completo</div>
        <div class="feature">‚úÖ Exporta√ß√£o em PDF</div>
        <div class="feature">‚úÖ Sem an√∫ncios</div>
      </div>
      <button class="btn-upgrade" onclick="openPaymentModal('premium')">
        Fazer Upgrade - R$ 19/m√™s
      </button>
    </div>

    <div class="plan-card escola-plan">
      <div class="plan-badge">Para Institui√ß√µes</div>
      <div class="plan-header">
        <h3>üè´ Escola</h3>
        <div class="plan-price">R$ 99<span>/m√™s</span></div>
      </div>
      <div class="plan-features">
        <div class="feature">‚úÖ At√© 50 professores</div>
        <div class="feature">‚úÖ Gera√ß√µes ilimitadas</div>
        <div class="feature">‚úÖ Painel administrativo</div>
        <div class="feature">‚úÖ Relat√≥rios de uso</div>
        <div class="feature">‚úÖ Suporte dedicado</div>
        <div class="feature">‚úÖ Treinamento inclu√≠do</div>
      </div>
      <button class="btn-upgrade" onclick="openPaymentModal('escola')">
        Fazer Upgrade - R$ 99/m√™s
      </button>
    </div>
  </div>

  <!-- Modal de Pagamento -->
  <div id="paymentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üí≥ Finalizar Pagamento</h2>
        <span class="close" onclick="closePaymentModal()">&times;</span>
      </div>
      
      <div class="payment-summary">
        <div class="selected-plan">
          <h3 id="selectedPlanName">Plano Premium</h3>
          <div class="plan-price" id="selectedPlanPrice">R$ 19/m√™s</div>
        </div>
      </div>

      <form id="paymentForm" class="payment-form">
        <div class="form-section">
          <h4>üìß Informa√ß√µes de Cobran√ßa</h4>
          <div class="form-group">
            <label for="billingEmail">E-mail para cobran√ßa:</label>
            <input type="email" id="billingEmail" name="billingEmail" required>
          </div>
        </div>

        <div class="form-section">
          <h4>üí≥ Dados do Cart√£o</h4>
          <div class="form-group">
            <label for="cardNumber">N√∫mero do Cart√£o:</label>
            <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="expiryDate">Validade:</label>
              <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/AA" maxlength="5" required>
            </div>
            <div class="form-group">
              <label for="cvv">CVV:</label>
              <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="4" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="cardName">Nome no Cart√£o:</label>
            <input type="text" id="cardName" name="cardName" required>
          </div>
        </div>

        <div class="payment-security">
          <div class="security-info">
            <span class="security-icon">üîí</span>
            <div>
              <strong>Pagamento 100% Seguro</strong>
              <p>Seus dados s√£o protegidos com criptografia SSL</p>
            </div>
          </div>
        </div>

        <div class="payment-actions">
          <button type="button" class="btn-cancel" onclick="closePaymentModal()">Cancelar</button>
          <button type="submit" class="btn-pay">
            <span class="btn-icon">üí≥</span>
            Processar Pagamento
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Sucesso -->
  <div id="successModal" class="modal">
    <div class="modal-content success-content">
      <div class="success-icon">‚úÖ</div>
      <h2>Pagamento Realizado com Sucesso!</h2>
      <p>Seu plano foi atualizado e voc√™ j√° pode aproveitar todos os benef√≠cios.</p>
      <button class="btn-continue" onclick="closeSuccessModal()">Continuar</button>
    </div>
  </div>
</div>

<style>
.upgrade-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.upgrade-header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 20px;
  color: white;
}

.upgrade-header h1 {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 1rem;
}

.upgrade-header p {
  font-size: 1.2rem;
  opacity: 0.9;
}

.plans-comparison {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-bottom: 3rem;
}

.plan-card {
  background: white;
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  border: 3px solid transparent;
  position: relative;
  transition: all 0.3s ease;
}

.plan-badge {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  background: #6b7280;
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

.plan-badge.popular {
  background: linear-gradient(135deg, #f59e0b, #d97706);
}

.current-plan {
  border-color: #10b981;
}

.premium-plan {
  border-color: #f59e0b;
  transform: scale(1.05);
}

.escola-plan {
  border-color: #6366f1;
}

.plan-header {
  text-align: center;
  margin: 2rem 0;
}

.plan-header h3 {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.plan-price {
  font-size: 2rem;
  font-weight: 800;
  color: #1f2937;
}

.plan-price span {
  font-size: 1rem;
  font-weight: 500;
  color: #6b7280;
}

.plan-features {
  margin: 2rem 0;
}

.feature {
  padding: 0.5rem 0;
  color: #374151;
  font-size: 0.9rem;
}

.btn-upgrade {
  width: 100%;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-upgrade:hover {
  background: linear-gradient(135deg, #d97706, #b45309);
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(217, 119, 6, 0.3);
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  backdrop-filter: blur(5px);
}

.modal-content {
  background-color: white;
  margin: 5% auto;
  padding: 0;
  border-radius: 20px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2rem;
  border-bottom: 1px solid #e5e7eb;
}

.modal-header h2 {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 700;
}

.close {
  font-size: 2rem;
  font-weight: bold;
  cursor: pointer;
  color: #6b7280;
}

.close:hover {
  color: #374151;
}

.payment-summary {
  padding: 2rem;
  background: #f8fafc;
  border-bottom: 1px solid #e5e7eb;
}

.selected-plan h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.2rem;
  font-weight: 700;
}

.payment-form {
  padding: 2rem;
}

.form-section {
  margin-bottom: 2rem;
}

.form-section h4 {
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #374151;
}

.form-group {
  margin-bottom: 1rem;
}

.form-row {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #374151;
}

.form-group input {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

.form-group input:focus {
  outline: none;
  border-color: #6366f1;
}

.payment-security {
  margin: 2rem 0;
  padding: 1rem;
  background: #f0f9ff;
  border-radius: 10px;
  border: 1px solid #0ea5e9;
}

.security-info {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.security-icon {
  font-size: 1.5rem;
}

.security-info strong {
  color: #0369a1;
}

.security-info p {
  margin: 0.25rem 0 0 0;
  font-size: 0.9rem;
  color: #0369a1;
}

.payment-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.btn-cancel {
  flex: 1;
  background: #f3f4f6;
  color: #374151;
  border: none;
  padding: 1rem;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-cancel:hover {
  background: #e5e7eb;
}

.btn-pay {
  flex: 2;
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  border: none;
  padding: 1rem;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.btn-pay:hover {
  background: linear-gradient(135deg, #059669, #047857);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
}

.success-content {
  text-align: center;
  padding: 3rem 2rem;
}

.success-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.success-content h2 {
  color: #10b981;
  margin-bottom: 1rem;
}

.btn-continue {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  border: none;
  padding: 1rem 2rem;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 2rem;
}

@media (max-width: 768px) {
  .upgrade-page {
    padding: 1rem;
  }
  
  .upgrade-header h1 {
    font-size: 2rem;
  }
  
  .plans-comparison {
    grid-template-columns: 1fr;
  }
  
  .premium-plan {
    transform: none;
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .payment-actions {
    flex-direction: column;
  }
}
</style>

<script>
let selectedPlan = '';

function openPaymentModal(plan) {
  selectedPlan = plan;
  const modal = document.getElementById('paymentModal');
  const planName = document.getElementById('selectedPlanName');
  const planPrice = document.getElementById('selectedPlanPrice');
  
  if (plan === 'premium') {
    planName.textContent = '‚≠ê Plano Premium';
    planPrice.textContent = 'R$ 19/m√™s';
  } else if (plan === 'escola') {
    planName.textContent = 'üè´ Plano Escola';
    planPrice.textContent = 'R$ 99/m√™s';
  }
  
  modal.style.display = 'block';
  
  // Preenche o email automaticamente se o usu√°rio estiver logado
  const billingEmail = document.getElementById('billingEmail');
  if (window.userEmail) {
    billingEmail.value = window.userEmail;
  }
}

function closePaymentModal() {
  document.getElementById('paymentModal').style.display = 'none';
}

function closeSuccessModal() {
  document.getElementById('successModal').style.display = 'none';
  // Redireciona para o painel
  window.location.href = '/painel';
}

// Formata√ß√£o autom√°tica dos campos
document.getElementById('cardNumber').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
  let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
  e.target.value = formattedValue;
});

document.getElementById('expiryDate').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length >= 2) {
    value = value.substring(0, 2) + '/' + value.substring(2, 4);
  }
  e.target.value = value;
});

document.getElementById('cvv').addEventListener('input', function(e) {
  e.target.value = e.target.value.replace(/[^0-9]/g, '');
});

// Submiss√£o do formul√°rio
document.getElementById('paymentForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // Simula processamento
  const submitBtn = e.target.querySelector('.btn-pay');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<span class="btn-icon">‚è≥</span> Processando...';
  submitBtn.disabled = true;
  
  // Simula delay de processamento
  setTimeout(() => {
    // Chama API para atualizar plano
    fetch('/api/usuario/upgrade', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        plano: selectedPlan,
        simulacao: true // Indica que √© uma simula√ß√£o
      })
    })
    .then(response => response.json())
    .then(result => {
      if (result.sucesso) {
        // Fecha modal de pagamento
        closePaymentModal();
        
        // Mostra modal de sucesso
        document.getElementById('successModal').style.display = 'block';
      } else {
        alert('Erro no processamento: ' + (result.erro || 'Erro desconhecido'));
      }
    })
    .catch(error => {
      alert('Erro de conex√£o: ' + error.message);
    })
    .finally(() => {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    });
  }, 2000);
});

// Fecha modal ao clicar fora
window.onclick = function(event) {
  const paymentModal = document.getElementById('paymentModal');
  const successModal = document.getElementById('successModal');
  
  if (event.target === paymentModal) {
    closePaymentModal();
  }
  if (event.target === successModal) {
    closeSuccessModal();
  }
}
</script>
{% endblock %}

